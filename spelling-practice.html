<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spelling Practice â€“ PTEGuide.com</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 16px;
    background: #f5f5f5;
}
button, select, input {
    font-size: 16px;
    padding: 10px;
    margin: 6px 0;
    width: 100%;
}
.hidden { display: none; }
.feedback.correct { color: green; }
.feedback.incorrect { color: red; }
#progressBar {
    width: 100%;
    height: 12px;
    background: #ddd;
    border-radius: 6px;
    overflow: hidden;
}
#progressFill {
    height: 100%;
    width: 0%;
    background: #4caf50;
}
</style>
</head>

<body>

<h2>PTEGuide.com â€“ Spelling Practice</h2>

<select id="profileSelect" onchange="switchProfile()">
    <option value="">Select Profile</option>
    <option>Zwala</option>
    <option>Ganga</option>
    <option>Poonam</option>
</select>

<input id="newWord" placeholder="Add new word">
<button onclick="addWord()">Add Word</button>

<button onclick="startPractice()">Start Practice</button>
<button onclick="toggleWordList()">Show Word List</button>

<div id="progressBar">
    <div id="progressFill"></div>
</div>
<div id="progressText"></div>

<div id="practiceArea" class="hidden">
    <input id="userInput" placeholder="Type spelling">
    <button onclick="checkSpelling()">Check</button>
    <button onclick="speakCurrentWord()">ðŸ”Š Play Word</button>
    <button onclick="nextWord()">Next</button>
    <div id="feedback" class="feedback"></div>
    <button id="showBtn" class="hidden" onclick="showAnswer()">Show Answer</button>
    <div id="answer"></div>
</div>

<div id="wordListBox" class="hidden"></div>

<script>
let profiles = ["Zwala", "Ganga", "Poonam"];
let currentProfile = "";
let words = [];
let sessionWords = [];
let currentIndex = 0;
let currentWord = "";
let practicedThisSession = new Set();

const profilePINs = {
    Zwala: "321",
    Ganga: "654",
    Poonam: "987"
};

function loadWords() {
    words = JSON.parse(localStorage.getItem("words_" + currentProfile)) || [];
}

function saveWords() {
    localStorage.setItem("words_" + currentProfile, JSON.stringify(words));
}

function switchProfile() {
    const selected = profileSelect.value;
    if (!selected) return;

    const pin = prompt(`Enter PIN for ${selected}`);
    if (pin !== profilePINs[selected]) {
        alert("Incorrect PIN");
        profileSelect.value = "";
        return;
    }

    currentProfile = selected;
    localStorage.setItem("lastProfile", currentProfile);
    loadWords();
    updateProgress();
    alert(`Welcome ${currentProfile}`);
}

function addWord() {
    if (!currentProfile) return alert("Select profile first");
    const w = newWord.value.trim().toLowerCase();
    if (w && !words.includes(w)) {
        words.push(w);
        saveWords();
    }
    newWord.value = "";
    updateWordListDisplay();
}

function startPractice() {
    if (!words.length) return alert("Add words first");
    sessionWords = [...words].sort(() => Math.random() - 0.5);
    currentIndex = 0;
    practicedThisSession.clear();
    practiceArea.classList.remove("hidden");
    speakCurrentWord();
}

function speakCurrentWord() {
    speechSynthesis.cancel(); // ðŸ”¥ REQUIRED FOR iOS
    currentWord = sessionWords[currentIndex];
    const u = new SpeechSynthesisUtterance(currentWord);
    u.lang = "en-US";
    speechSynthesis.speak(u);
    userInput.value = "";
    feedback.textContent = "";
    showBtn.classList.add("hidden");
    practicedThisSession.add(currentWord);
    updateProgress();
}

function nextWord() {
    if (currentIndex < sessionWords.length - 1) {
        currentIndex++;
        speakCurrentWord();
    } else {
        alert("All words practiced!");
    }
}

function checkSpelling() {
    if (userInput.value.trim().toLowerCase() === currentWord) {
        feedback.textContent = "Correct";
        feedback.className = "feedback correct";
    } else {
        feedback.textContent = "Incorrect";
        feedback.className = "feedback incorrect";
        showBtn.classList.remove("hidden");
    }
}

function showAnswer() {
    answer.textContent = "Correct spelling: " + currentWord;
}

function updateProgress() {
    const p = words.length ? practicedThisSession.size / words.length * 100 : 0;
    progressFill.style.width = p + "%";
    progressText.textContent = practicedThisSession.size + " / " + words.length;
}

function toggleWordList() {
    wordListBox.classList.toggle("hidden");
    updateWordListDisplay();
}

function updateWordListDisplay() {
    wordListBox.innerHTML = words.length
        ? "<b>Words:</b><br>" + words.join(", ")
        : "No words added";
}

document.addEventListener("DOMContentLoaded", () => {
    const last = localStorage.getItem("lastProfile");
    if (last && profiles.includes(last)) {
        profileSelect.value = last;
    }
});
</script>

</body>
</html>
